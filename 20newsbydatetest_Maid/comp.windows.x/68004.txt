from. gdmr@dcs.ed.ac.uk (george ross). subject. twm & greyscale. organization. department of computer science, edinburgh university. lines. . . as distributed, twm thinks everything with three or more colormap cells must. be a colour screen. here's a patch to have it use the screen's visual class.. . *** twm.c.dist wed may . . twm.c wed may . . ***************. *** , ****. , . . scr >xorvalue = (((unsigned long) ) d depth) ;. . + #ifdef oldcode. if (displaycells(dpy, scrnum) monochrome = monochrome;. else. scr >monochrome = color;. + #else. + { xvisualinfo template;. + xvisualinfo *visualinfo;. + int nitems;. + . + template.visual = defaultvisual(dpy, scrnum);. + template.visualid = xvisualidfromvisual(template.visual);. + template.screen = scrnum;. + visualinfo = xgetvisualinfo(dpy, visualidmask.visualscreenmask,. + &template, &nitems);. + if (nitems == ) {. + switch (visualinfo >class) {. + case staticcolor.. + case pseudocolor.. + case truecolor.. + case directcolor.. + scr >monochrome = color;. + break;. + . + default. scr >monochrome = monochrome;. + break;. + }. + }. + else {. + (void) fprintf(stderr,. + "%d visual match(es), assuming mono\n",. + nitems);. + scr >monochrome = monochrome; /* assume */. + }. + }. + #endif. . /* setup default colors */. scr >firsttime = true;. . . george d m ross, department of computer science, university of edinburgh. kings buildings, mayfield road, edinburgh, scotland, eh jz. mail. gdmr@dcs.ed.ac.uk voice. fax. .